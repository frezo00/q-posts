"use strict";(self.webpackChunkq_posts=self.webpackChunkq_posts||[]).push([[592],{8291:(F,p,m)=>{m.d(p,{i:()=>q});var d=m(7709),c=m(5345);class g{constructor(s){this.notifier=s}call(s,o){const e=new _(s),r=(0,c.ft)(this.notifier,new c.IY(e));return r&&!e.seenValue?(e.add(r),o.subscribe(e)):e}}class _ extends c.Ds{constructor(s){super(s),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}var h=m(3190),t=m(639),a=m(7319),u=m(8583),C=m(2555);function b(n,s){if(1&n&&(t.TgZ(0,"article",1),t.TgZ(1,"strong",2),t._uU(2),t.qZA(),t.TgZ(3,"span",3),t._uU(4),t.qZA(),t.qZA()),2&n){const o=s.$implicit;t.xp6(2),t.AsE("",o.name," (",o.email,")"),t.xp6(2),t.Oqu(o.body)}}let x=(()=>{class n{constructor(){this.comments=[]}}return n.\u0275fac=function(o){return new(o||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["q-comments"]],inputs:{comments:"comments"},decls:1,vars:1,consts:[["class","comments__item",4,"ngFor","ngForOf"],[1,"comments__item"],[1,"comments__author"],[1,"comment__text"]],template:function(o,e){1&o&&t.YNc(0,b,5,3,"article",0),2&o&&t.Q6J("ngForOf",e.comments)},directives:[u.sg],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;margin:12px 0;border-radius:4px;overflow:hidden}.comments__item[_ngcontent-%COMP%]{display:flex;flex-direction:column;color:inherit;font-size:.875rem;padding:12px 20px;border-bottom:1px solid #e8e8e8;background-color:#f4f4f4}.comments__item[_ngcontent-%COMP%]:last-child{margin-bottom:0;border-bottom:none}.comments__text[_ngcontent-%COMP%]{white-space:pre-wrap}"]}),n})();var i=m(3679);let v=(()=>{class n{transform(o){return o&&o.errors&&(o.dirty||o.touched)?this._getErrorMessage(o.errors):""}_getErrorMessage(o){switch(Object.keys(o)[0]){case"required":return"This field is required";case"maxlength":return`Maximum input length is: ${o.maxlength.requiredLength}`;default:return""}}}return n.\u0275fac=function(o){return new(o||n)},n.\u0275pipe=t.Yjl({name:"formControlError",type:n,pure:!1}),n})(),Z=(()=>{class n{constructor(o){this._formBuilder=o,this.commentCreate=new t.vpe,this.maxLength=500}ngOnInit(){this.commentForm=this._formBuilder.group({comment:["",[i.kI.required,i.kI.maxLength(this.maxLength)]]})}onCommentSubmit(){var o,e;if(this.commentForm.invalid)return void(null===(o=this.commentForm)||void 0===o||o.markAllAsTouched());const r=null===(e=this.commentForm.get("comment"))||void 0===e?void 0:e.value;this.commentCreate.emit(r),this.commentForm.reset()}}return n.\u0275fac=function(o){return new(o||n)(t.Y36(i.qu))},n.\u0275cmp=t.Xpm({type:n,selectors:[["q-comment-form"]],outputs:{commentCreate:"commentCreate"},decls:14,vars:7,consts:[[1,"form",3,"formGroup","ngSubmit"],[1,"form-control"],["formControlName","comment","name","comment","id","comment","rows","4",1,"form-control__input","hide-scrollbar"],[1,"form-control-validation"],[1,"form-control-validation__error"],[1,"form-control-validation__info"],[1,"button-group"],[1,"button","button--primary",3,"disabled"],["type","reset",1,"button","button--secondary"]],template:function(o,e){if(1&o&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return e.onCommentSubmit()}),t.TgZ(1,"article",1),t._UZ(2,"textarea",2),t.TgZ(3,"section",3),t.TgZ(4,"small",4),t._uU(5),t.ALo(6,"formControlError"),t.qZA(),t.TgZ(7,"small",5),t._uU(8),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"section",6),t.TgZ(10,"button",7),t._uU(11,"Submit"),t.qZA(),t.TgZ(12,"button",8),t._uU(13,"Clear"),t.qZA(),t.qZA(),t.qZA()),2&o){let r;t.Q6J("formGroup",e.commentForm),t.xp6(5),t.Oqu(t.lcZ(6,5,e.commentForm.get("comment"))),t.xp6(3),t.AsE(" ",(null==(r=e.commentForm.get("comment"))||null==r.value?null:r.value.length)||0," / ",e.maxLength," "),t.xp6(2),t.Q6J("disabled",e.commentForm.invalid)}},directives:[i._Y,i.JL,i.sg,i.Fj,i.JJ,i.u],pipes:[v],styles:[""]}),n})();function y(n,s){if(1&n&&(t.TgZ(0,"h1",5),t._uU(1),t.qZA()),2&n){const o=t.oxw();t.xp6(1),t.Oqu(null==o.post?null:o.post.title)}}function P(n,s){if(1&n&&(t.TgZ(0,"a",6),t._uU(1),t.qZA()),2&n){const o=t.oxw();t.MGl("routerLink","/post/",null==o.post?null:o.post.id,""),t.xp6(1),t.Oqu(null==o.post?null:o.post.title)}}const T=function(){return[]};function w(n,s){if(1&n){const o=t.EpF();t.ynx(0),t._UZ(1,"q-comments",7),t.TgZ(2,"q-comment-form",8),t.NdJ("commentCreate",function(r){return t.CHM(o),t.oxw().onNewComment(r)}),t.qZA(),t.BQk()}if(2&n){const o=t.oxw();t.xp6(1),t.Q6J("comments",(null==o.post?null:o.post.comments)||t.DdM(1,T))}}let q=(()=>{class n{constructor(o,e,r,l){this._postsService=o,this._commentsService=e,this._profileService=r,this._cdRef=l,this.isPostPage=!1,this.destroy$=new d.xQ,this.showComments=!1}set showPostComments(o){this.toggleComments(null!=o&&o)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}toggleComments(o){this.showComments=null!=o?o:!this.showComments}onNewComment(o){const e={body:o,postId:this.post.id};this._profileService.getProfile$().pipe((0,h.w)(r=>this._commentsService.createComment$(Object.assign(Object.assign({},e),r))),function(n){return s=>s.lift(new g(n))}(this.destroy$)).subscribe(r=>{var l;null===(l=this.post.comments)||void 0===l||l.push(r),this._postsService.updatePost(this.post),this._cdRef.markForCheck()})}}return n.\u0275fac=function(o){return new(o||n)(t.Y36(a.PJ),t.Y36(a.rB),t.Y36(a.H3),t.Y36(t.sBO))},n.\u0275cmp=t.Xpm({type:n,selectors:[["q-post-card"]],inputs:{post:"post",isPostPage:"isPostPage",showPostComments:"showPostComments"},decls:12,vars:11,consts:[["class","post-card__title",4,"ngIf","ngIfElse"],["titleLink",""],[1,"post-card__body"],[1,"button","button--secondary",3,"click"],[4,"ngIf"],[1,"post-card__title"],[1,"post-card__title","link",3,"routerLink"],[3,"comments"],[3,"commentCreate"]],template:function(o,e){if(1&o&&(t.TgZ(0,"header"),t.YNc(1,y,2,1,"h1",0),t.YNc(2,P,2,2,"ng-template",null,1,t.W1O),t.TgZ(4,"span"),t._uU(5),t.qZA(),t.qZA(),t.TgZ(6,"p",2),t._uU(7),t.qZA(),t.TgZ(8,"footer"),t.TgZ(9,"button",3),t.NdJ("click",function(){return e.toggleComments()}),t._uU(10),t.qZA(),t.YNc(11,w,3,2,"ng-container",4),t.qZA()),2&o){const r=t.MAs(3);t.xp6(1),t.Q6J("ngIf",e.isPostPage)("ngIfElse",r),t.xp6(4),t.AsE("",null==e.post||null==e.post.user?null:e.post.user.name," (#",null==e.post||null==e.post.user?null:e.post.user.username,")"),t.xp6(1),t.ekj("post-card__body--truncate",!e.isPostPage),t.xp6(1),t.Oqu(null==e.post?null:e.post.body),t.xp6(2),t.ekj("button--active",e.showComments),t.xp6(1),t.hij(" Comments (",null==e.post||null==e.post.comments?null:e.post.comments.length,") "),t.xp6(1),t.Q6J("ngIf",e.showComments)}},directives:[u.O5,C.yS,x,Z],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;transition:transform .3s ease-out,box-shadow .3s ease-out;padding:20px;margin:12px;background-color:#fff;border-radius:4px}[_nghost-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 4px 8px #00000014}.post-card__title[_ngcontent-%COMP%]{color:inherit;font-size:1.25rem;font-weight:700;display:block;margin:0 0 12px}.post-card__body[_ngcontent-%COMP%]{color:#788087;white-space:pre-wrap}.post-card__body--truncate[_ngcontent-%COMP%]{max-width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"],changeDetection:0}),n})()}}]);